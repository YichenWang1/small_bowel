# APOBEC mutagenesis is a common process in normal human small intestine. Wang et al.

Scripts used to reproduce the analyses of the manuscript are available at: https://github.com/YichenWang1/small_bowel. Please contact Yichen (yw2@sanger.ac.uk) if you have any questions and enquires.

## Dataset

Raw sequencing data can be accessed from the European Genome-phenome Archive (EGA) with the accession code EGAD00001008764.

Input data for all figures can be found under the /data directory.

data/somatic_mutations/snp/ contains the final SNPs placed on phylogenetic branches.

data/somatic_mutations/indel/ contains the final INDELs placed on phylogenetic branches.

data/mutation_matrices/ contains the final SBS and ID matrices for the cohort.

data/signatures/ contains the original HDP sigantures, their decomposition to PCAWAG reference signatures, and the final reference signature exposures for each samples and each phylogenetic branch.

data/phylogenetic_trees/ contains the phylogenetic trees generated by MPBoot using single-base substitutions and indels. The length of the branch represents the number of mutations on the branch. 

data/vcf/ contains the final SNP vcf files for finding and plotting kataegis.

data/cancer/ contains the paired cancer data for comparison (mutational burden and mutational siganture exposures).

data/motif/ contains enrichment scores for TCN motifs

## Variant calling
The final mutation files can be found in extended data tables and data/somatic_mutations/. 

Alternatively, they can be generated from the raw file via the Sanger pipeline (https://github.com/cancerit) using CaveMan, Pindel, ASCAT, BRASS. When a matched normal sample is available, run all algorithms using that sample as matched normal. Otherwise, run unmatched with a synthetic bam PDv37is.

## Filtering
The filters applied to SNVs and Indels to exclude LCM artefacts can be found at: https://github.com/MathijsSanders/SangerLCMFiltering, and the beta-binomial filter to exclude germline mutations are here: https://github.com/TimCoorens/Unmatched_NormSeq.

## Phylogenetic tree reconstruction

Phylogentic trees were constructed using MPBoot, with supplementary code in Phylogenetics/.

Phylogenetics/filtering.R contains the beta-binomial filter for the previous step and will generate the input *for_MPBoot.fa file for MPBoot. Then run:

```mpboot -s $patient/${opt}_for_MPBoot.fa -bb 1000```

Reconstructed phylogenetic trees (with number of mutations on each branch) can be found at data/phylogenetic_trees/. The trees can then be visualised by treeplots.R.

## Mutational signature extraction
We only kept branches with > 50 mutations during the run, and the input data can be found at data/mutational_matrices/.

Workflow and code are in the directory /Signatures.

## Mutational burden analysis
The input file is at data/Extended\_Data\_Table3\_crypt\_summary.csv

Workflow and code are in the directory Mutational_burden/.

## Local hypermutation (kataegis) analysis
The code is in the directory Kataegis/ and the input vcf files are at data/vcf/.

## RNA-seq
The code is in the directory Expression/, instructions about how to download the input dataset are included in the script.

## Motif enrichment
The code is in the directory APOBEC_motif/, the input vcf files are at data/vcf/ and the output is at data/motif/.
