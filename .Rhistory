scale.fn <- function(x) {x / sqrt(sum(x^2))}
for (name in names(obsstats)) {
ss[,name] <- scale.fn(ss[,name])
}
head(ss)
ss[is.na(ss)] <- 0
# pdf("distances_for_each_vaf_bin_after_normalising.pdf")
# par(mfrow=c(5,5))
# par(mar=c(1,1,1,1))
for (name in names(obsstats)) {
hist(ss[,name], col="grey", 50, main=name, cex.main=0.5)
}
# dev.off()
ss$dist4 <- rowSums(ss[,grep("PD", names(obsstats), value=T)])
hist(ss$dist4, col="grey", 50)
# reorder them based on the distance.
head(ss)
# write.table(ss, "normalised_distances_to_observed.txt", sep="\t", col.names = T, row.names=F, quote=F)
#ss <- read.csv("normalised_distances_to_observed.txt", sep="\t", header=T, stringsAsFactors = F)
ss$meanyears_to_MRCA <- apply(ss[,grep("years_to_MRCA", colnames(ss))], 1, function(row)
mean(row, na.rm=T))
ss4 <- ss[with(ss, order(dist4, decreasing=F)),]
# pick the best 10%
astats4 <- ss4[1:round(nrow(ss)*0.01),]
dim(astats4)
# colour them by the best.
# I want to colour the bottom 90% one colour, the top 10% another colour,
# the top 5% another colour, and the top 1% another colour
display.brewer.pal(10, "Spectral")
mypal <- RColorBrewer::brewer.pal(10, 'Spectral')[c(1,2,3,9)]
# plot(c(1:4), col=mypal, pch=16, cex=3)
ss4 <- ss[with(ss, order(dist4), decreasing=T),]
ss4$discol <- mypal[4]
#ss6$discol[1:round(nrow(ss)*0.1)] <- mypal[3]
ss4$discol[1:round(nrow(ss)*0.01)] <- mypal[2]
ss4$discol[1:round(nrow(ss)*0.001)] <- mypal[1]
# pdf("Best_simulations_3_colours.pdf")
pdf(paste0("/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/output/",patient,".pdf"),height = 8,width = 8)
par(mfrow=c(3,1))
# par(mar=c(4,4,4,1))
plot(stem~gendays, data=ss4[nrow(ss4):1,], col=ss4$discol[nrow(ss4):1], pch=16,
main="Simulations coloured by \n similarity to observed with 4 reads",
xlab="Stem cell replacement rate (days)", ylab="Stem cell effective population size")
legend("topright", legend=c("best 0.1%", "0.1-1%", "1-100%"), col=mypal[c(1,2,4)], pch=16, cex=1,
bg="white")
# legend("topright", legend=c("best 0.1%", "0.1-1%", "1-10%", "10-100%"), col=mypal, pch=16, cex=1,
#        bg="white")
# par(mfrow=c(2,1))
hist(ss$meanyears_to_MRCA, col="grey", 50,  xlab="Years to MRCA",
main=paste0("Mean time to MRCA, prior distribution \n CI95: ", paste(round(sort(ss$meanyears_to_MRCA)[c(round(length(ss$meanyears_to_MRCA)*0.025), round(length(ss$meanyears_to_MRCA)*0.975))], digits=1), collapse="-"), " years"))
# dev.off()
mean(ss$meanyears_to_MRCA)
median(ss$meanyears_to_MRCA)
# plot(meanyears_to_MRCA~gendays, data=astats4)
hist(astats4$meanyears_to_MRCA, col="grey", 50, xlab="Years to MRCA",
main=paste0("Mean time to MRCA, best 1% estimation \n CI95: ", paste(round(sort(astats4$meanyears_to_MRCA)[c(round(length(astats4$meanyears_to_MRCA)*0.025), round(length(astats4$meanyears_to_MRCA)*0.975))], digits=1), collapse="-"), " years"))
mean(astats4$meanyears_to_MRCA) # 5.5
median(astats4$meanyears_to_MRCA) # 5.5
dev.off()
meanyears_to_MRCA$median_meanyears_to_MRCA[meanyears_to_MRCA$patient==patient] = median(astats4$meanyears_to_MRCA)
meanyears_to_MRCA$mean_meanyears_to_MRCA[meanyears_to_MRCA$patient==patient] = mean(astats4$meanyears_to_MRCA)
meanyears_to_MRCA$upper_95_CI[meanyears_to_MRCA$patient==patient] = round(sort(ss$meanyears_to_MRCA)[round(length(ss$meanyears_to_MRCA)*0.975)])
meanyears_to_MRCA$lower_95_CI[meanyears_to_MRCA$patient==patient] = round(sort(ss$meanyears_to_MRCA)[round(length(ss$meanyears_to_MRCA)*0.025)])
}
patient
reord
reord1
reord2
sumstats
View(data)
crypt_lst
colnames(sumstats)
View(sumstats)
View(obs_patient)
n_crypts
crypt_lst
dim(sumstats)
24/15
240/15
patient
View(data)
View(data)
#---------PD43853---------------
patient='PD43853'
main_dir=paste0('/Users/yw2/Documents/FARM/yw2/small_bowel/filter/',patient)
patient_vcf<-read.table(paste0(main_dir,"/",patient,".snp.tsv"),comment.char = "", header=T,stringsAsFactors = F)
patient_vcf<-read.table(paste0(main_dir,"/",patient,".snp.tsv"),comment.char = "", header=T,stringsAsFactors = F)
View(patient_vcf)
rownames(patient_vcf)=paste(patient_vcf$Chrom,patient_vcf$Pos,patient_vcf$Ref,patient_vcf$Alt, sep = '_')
#snp on branch
snp_on_branch = read.table(paste0('/Users/yw2/Documents/FARM/yw2/small_bowel/filter/',patient,'/',patient,'_snp_assigned_to_branches.txt'))
View(snp_on_branch)
#snp on branch
snp_on_branch = read.table(paste0('/Users/yw2/Documents/FARM/yw2/small_bowel/filter/',patient,'/',patient,'_snp_assigned_to_branches.txt'),header=T)
rownames(snp_on_branch) = paste(snp_on_branch$Chr, snp_on_branch$Pos, snp_on_branch$Ref, snp_on_branch$Alt, sep = '_')
View(SNP_file)
View(snp_on_branch)
patient_vcf = patient_vcf[rownames(snp_on_branch),]
View(patient_vcf)
#---------extract VAF---------------
for (patient in unique(data$patient)){
locus_list = data$sample[data$patient==patient]
main_dir=paste0('/Users/yw2/Documents/FARM/yw2/small_bowel/filter/',patient)
patient_vcf<-read.table(paste0(main_dir,"/",patient,".snp.tsv"),comment.char = "", header=T,stringsAsFactors = F)
rownames(patient_vcf)=paste(patient_vcf$Chrom,patient_vcf$Pos,patient_vcf$Ref,patient_vcf$Alt, sep = '_')
df= data.frame(matrix(nrow=0,ncol=4))
for (locus in locus_list){
good_snp <-read.table(paste0("/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/code/small_bowel/data/vcf/",locus,"_final_snp.vcf"),header=F, stringsAsFactors = F)
good_snp <- good_snp[!duplicated(good_snp),]
rownames(good_snp)=paste(good_snp$V1,good_snp$V2,good_snp$V4,good_snp$V5, sep = '_')
sample_vcf = patient_vcf[rownames(good_snp),]
all_alt<-sample_vcf[,colnames(sample_vcf[grep('MTR',colnames(sample_vcf))])]
all_dep<-sample_vcf[,colnames(sample_vcf[grep('DEP',colnames(sample_vcf))])]
sample_alt<-all_alt[,colnames(all_alt)[grep(locus,colnames(all_alt))]]
sample_dep<-all_dep[,colnames(all_dep)[grep(locus,colnames(all_dep))]]
df_sample=data.frame(ALT=sample_alt,DEP=sample_dep)
df_sample <- na.omit(df_sample[df_sample$ALT>=4,])
df_sample$VAF = df_sample$ALT/df_sample$DEP
df_sample$locus = locus
write.table(df_sample,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/6mtr/',locus,'_VAF.txt'),quote=F,row.names=F,col.names=T)
df = rbind(df,df_sample)
input_stat=c(median(df_sample$VAF),dim(df_sample)[1])
input_stat = c(input_stat,df_sample$DEP)
n_col=100
n_row = ceiling(length(input_stat)/100)
input_stat = c(input_stat,rep("",n_col*n_row-length(input_stat)))
input_stat=matrix(input_stat,ncol = n_col,byrow=T)
write.table(input_stat,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/input_files/4mtr/',locus,'_input_data.txt'),quote=F,row.names=F,col.names=F)
}
df <-df[df$locus %in% data$sample[which(data$ref == 'Crypt')],]
write.table(df,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/6mtr/',patient,'_VAF.txt'),quote=F,row.names=F,col.names=T)
pdf(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',patient,'_VAF_plot.pdf'),height = 2, width = 2)
print(ggplot(df, aes(x = VAF)) + geom_density(aes(group=factor(locus)), fill="grey", size=0.5, alpha=.4)+ggtitle(patient)+ylab('Density')+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour='black')))
dev.off()
pdf(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',patient,'_VAF_plot_v2.pdf'),height = 2, width = 2)
print(ggplot(df, aes(x = VAF)) + geom_density(aes(group=factor(patient)), fill="grey", size=0.5, alpha=.4)+ggtitle(patient)+ylab('Density')+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour='black')))
dev.off()
}
locus
unique(data$ref)
#---------extract VAF---------------
for (patient in unique(data$patient)){
locus_list = data$sample[data$patient==patient]
main_dir=paste0('/Users/yw2/Documents/FARM/yw2/small_bowel/filter/',patient)
patient_vcf<-read.table(paste0(main_dir,"/",patient,".snp.tsv"),comment.char = "", header=T,stringsAsFactors = F)
rownames(patient_vcf)=paste(patient_vcf$Chrom,patient_vcf$Pos,patient_vcf$Ref,patient_vcf$Alt, sep = '_')
df= data.frame(matrix(nrow=0,ncol=4))
for (locus in locus_list){
if(loucs %in% data$sample[data$ref!="Crypt"]){
next
}
good_snp <-read.table(paste0("/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/code/small_bowel/data/vcf/",locus,"_final_snp.vcf"),header=F, stringsAsFactors = F)
good_snp <- good_snp[!duplicated(good_snp),]
rownames(good_snp)=paste(good_snp$V1,good_snp$V2,good_snp$V4,good_snp$V5, sep = '_')
sample_vcf = patient_vcf[rownames(good_snp),]
all_alt<-sample_vcf[,colnames(sample_vcf[grep('MTR',colnames(sample_vcf))])]
all_dep<-sample_vcf[,colnames(sample_vcf[grep('DEP',colnames(sample_vcf))])]
sample_alt<-all_alt[,colnames(all_alt)[grep(locus,colnames(all_alt))]]
sample_dep<-all_dep[,colnames(all_dep)[grep(locus,colnames(all_dep))]]
df_sample=data.frame(ALT=sample_alt,DEP=sample_dep)
df_sample <- na.omit(df_sample[df_sample$ALT>=4,])
df_sample$VAF = df_sample$ALT/df_sample$DEP
df_sample$locus = locus
write.table(df_sample,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/6mtr/',locus,'_VAF.txt'),quote=F,row.names=F,col.names=T)
df = rbind(df,df_sample)
input_stat=c(median(df_sample$VAF),dim(df_sample)[1])
input_stat = c(input_stat,df_sample$DEP)
n_col=100
n_row = ceiling(length(input_stat)/100)
input_stat = c(input_stat,rep("",n_col*n_row-length(input_stat)))
input_stat=matrix(input_stat,ncol = n_col,byrow=T)
write.table(input_stat,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/input_files/4mtr/',locus,'_input_data.txt'),quote=F,row.names=F,col.names=F)
}
df <-df[df$locus %in% data$sample[which(data$ref == 'Crypt')],]
write.table(df,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/6mtr/',patient,'_VAF.txt'),quote=F,row.names=F,col.names=T)
pdf(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',patient,'_VAF_plot.pdf'),height = 2, width = 2)
print(ggplot(df, aes(x = VAF)) + geom_density(aes(group=factor(locus)), fill="grey", size=0.5, alpha=.4)+ggtitle(patient)+ylab('Density')+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour='black')))
dev.off()
pdf(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',patient,'_VAF_plot_v2.pdf'),height = 2, width = 2)
print(ggplot(df, aes(x = VAF)) + geom_density(aes(group=factor(patient)), fill="grey", size=0.5, alpha=.4)+ggtitle(patient)+ylab('Density')+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour='black')))
dev.off()
}
#---------extract VAF---------------
for (patient in unique(data$patient)){
locus_list = data$sample[data$patient==patient]
main_dir=paste0('/Users/yw2/Documents/FARM/yw2/small_bowel/filter/',patient)
patient_vcf<-read.table(paste0(main_dir,"/",patient,".snp.tsv"),comment.char = "", header=T,stringsAsFactors = F)
rownames(patient_vcf)=paste(patient_vcf$Chrom,patient_vcf$Pos,patient_vcf$Ref,patient_vcf$Alt, sep = '_')
df= data.frame(matrix(nrow=0,ncol=4))
for (locus in locus_list){
if(locus %in% data$sample[data$ref!="Crypt"]){
next
}
good_snp <-read.table(paste0("/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/code/small_bowel/data/vcf/",locus,"_final_snp.vcf"),header=F, stringsAsFactors = F)
good_snp <- good_snp[!duplicated(good_snp),]
rownames(good_snp)=paste(good_snp$V1,good_snp$V2,good_snp$V4,good_snp$V5, sep = '_')
sample_vcf = patient_vcf[rownames(good_snp),]
all_alt<-sample_vcf[,colnames(sample_vcf[grep('MTR',colnames(sample_vcf))])]
all_dep<-sample_vcf[,colnames(sample_vcf[grep('DEP',colnames(sample_vcf))])]
sample_alt<-all_alt[,colnames(all_alt)[grep(locus,colnames(all_alt))]]
sample_dep<-all_dep[,colnames(all_dep)[grep(locus,colnames(all_dep))]]
df_sample=data.frame(ALT=sample_alt,DEP=sample_dep)
df_sample <- na.omit(df_sample[df_sample$ALT>=4,])
df_sample$VAF = df_sample$ALT/df_sample$DEP
df_sample$locus = locus
write.table(df_sample,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/6mtr/',locus,'_VAF.txt'),quote=F,row.names=F,col.names=T)
df = rbind(df,df_sample)
input_stat=c(median(df_sample$VAF),dim(df_sample)[1])
input_stat = c(input_stat,df_sample$DEP)
n_col=100
n_row = ceiling(length(input_stat)/100)
input_stat = c(input_stat,rep("",n_col*n_row-length(input_stat)))
input_stat=matrix(input_stat,ncol = n_col,byrow=T)
write.table(input_stat,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/input_files/4mtr/',locus,'_input_data.txt'),quote=F,row.names=F,col.names=F)
}
df <-df[df$locus %in% data$sample[which(data$ref == 'Crypt')],]
write.table(df,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/6mtr/',patient,'_VAF.txt'),quote=F,row.names=F,col.names=T)
pdf(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',patient,'_VAF_plot.pdf'),height = 2, width = 2)
print(ggplot(df, aes(x = VAF)) + geom_density(aes(group=factor(locus)), fill="grey", size=0.5, alpha=.4)+ggtitle(patient)+ylab('Density')+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour='black')))
dev.off()
pdf(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',patient,'_VAF_plot_v2.pdf'),height = 2, width = 2)
print(ggplot(df, aes(x = VAF)) + geom_density(aes(group=factor(patient)), fill="grey", size=0.5, alpha=.4)+ggtitle(patient)+ylab('Density')+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour='black')))
dev.off()
}
#---------extract VAF---------------
for (patient in unique(data$patient)){
locus_list = data$sample[data$patient==patient]
main_dir=paste0('/Users/yw2/Documents/FARM/yw2/small_bowel/filter/',patient)
patient_vcf<-read.table(paste0(main_dir,"/",patient,".snp.tsv"),comment.char = "", header=T,stringsAsFactors = F)
rownames(patient_vcf)=paste(patient_vcf$Chrom,patient_vcf$Pos,patient_vcf$Ref,patient_vcf$Alt, sep = '_')
df= data.frame(matrix(nrow=0,ncol=4))
for (locus in locus_list){
if(locus %in% data$sample[data$ref!="Crypt"]){
next
}
good_snp <-read.table(paste0("/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/code/small_bowel/data/vcf/",locus,"_final_snp.vcf"),header=F, stringsAsFactors = F)
good_snp <- good_snp[!duplicated(good_snp),]
rownames(good_snp)=paste(good_snp$V1,good_snp$V2,good_snp$V4,good_snp$V5, sep = '_')
sample_vcf = patient_vcf[rownames(good_snp),]
all_alt<-sample_vcf[,colnames(sample_vcf[grep('MTR',colnames(sample_vcf))])]
all_dep<-sample_vcf[,colnames(sample_vcf[grep('DEP',colnames(sample_vcf))])]
sample_alt<-all_alt[,colnames(all_alt)[grep(locus,colnames(all_alt))]]
sample_dep<-all_dep[,colnames(all_dep)[grep(locus,colnames(all_dep))]]
df_sample=data.frame(ALT=sample_alt,DEP=sample_dep)
df_sample <- na.omit(df_sample[df_sample$ALT>=4,])
df_sample$VAF = df_sample$ALT/df_sample$DEP
df_sample$locus = locus
write.table(df_sample,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',locus,'_VAF.txt'),quote=F,row.names=F,col.names=T)
df = rbind(df,df_sample)
input_stat=c(median(df_sample$VAF),dim(df_sample)[1])
input_stat = c(input_stat,df_sample$DEP)
n_col=100
n_row = ceiling(length(input_stat)/100)
input_stat = c(input_stat,rep("",n_col*n_row-length(input_stat)))
input_stat=matrix(input_stat,ncol = n_col,byrow=T)
write.table(input_stat,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/input_files/4mtr/',locus,'_input_data.txt'),quote=F,row.names=F,col.names=F)
}
df <-df[df$locus %in% data$sample[which(data$ref == 'Crypt')],]
write.table(df,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/6mtr/',patient,'_VAF.txt'),quote=F,row.names=F,col.names=T)
pdf(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',patient,'_VAF_plot.pdf'),height = 2, width = 2)
print(ggplot(df, aes(x = VAF)) + geom_density(aes(group=factor(locus)), fill="grey", size=0.5, alpha=.4)+ggtitle(patient)+ylab('Density')+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour='black')))
dev.off()
pdf(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',patient,'_VAF_plot_v2.pdf'),height = 2, width = 2)
print(ggplot(df, aes(x = VAF)) + geom_density(aes(group=factor(patient)), fill="grey", size=0.5, alpha=.4)+ggtitle(patient)+ylab('Density')+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour='black')))
dev.off()
}
#---------extract VAF---------------
for (patient in unique(data$patient)){
locus_list = data$sample[data$patient==patient]
main_dir=paste0('/Users/yw2/Documents/FARM/yw2/small_bowel/filter/',patient)
patient_vcf<-read.table(paste0(main_dir,"/",patient,".snp.tsv"),comment.char = "", header=T,stringsAsFactors = F)
rownames(patient_vcf)=paste(patient_vcf$Chrom,patient_vcf$Pos,patient_vcf$Ref,patient_vcf$Alt, sep = '_')
df= data.frame(matrix(nrow=0,ncol=4))
for (locus in locus_list){
if(locus %in% data$sample[data$ref!="Crypt"]){
next
}
good_snp <-read.table(paste0("/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/code/small_bowel/data/vcf/",locus,"_final_snp.vcf"),header=F, stringsAsFactors = F)
good_snp <- good_snp[!duplicated(good_snp),]
rownames(good_snp)=paste(good_snp$V1,good_snp$V2,good_snp$V4,good_snp$V5, sep = '_')
sample_vcf = patient_vcf[rownames(good_snp),]
all_alt<-sample_vcf[,colnames(sample_vcf[grep('MTR',colnames(sample_vcf))])]
all_dep<-sample_vcf[,colnames(sample_vcf[grep('DEP',colnames(sample_vcf))])]
sample_alt<-all_alt[,colnames(all_alt)[grep(locus,colnames(all_alt))]]
sample_dep<-all_dep[,colnames(all_dep)[grep(locus,colnames(all_dep))]]
df_sample=data.frame(ALT=sample_alt,DEP=sample_dep)
df_sample <- na.omit(df_sample[df_sample$ALT>=4,])
df_sample$VAF = df_sample$ALT/df_sample$DEP
df_sample$locus = locus
write.table(df_sample,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',locus,'_VAF.txt'),quote=F,row.names=F,col.names=T)
df = rbind(df,df_sample)
input_stat=c(median(df_sample$VAF),dim(df_sample)[1])
input_stat = c(input_stat,df_sample$DEP)
n_col=100
n_row = ceiling(length(input_stat)/100)
input_stat = c(input_stat,rep("",n_col*n_row-length(input_stat)))
input_stat=matrix(input_stat,ncol = n_col,byrow=T)
write.table(input_stat,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/input_files/4mtr/',locus,'_input_data.txt'),quote=F,row.names=F,col.names=F)
}
df <-df[df$locus %in% data$sample[which(data$ref == 'Crypt')],]
write.table(df,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',patient,'_VAF.txt'),quote=F,row.names=F,col.names=T)
pdf(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',patient,'_VAF_plot.pdf'),height = 2, width = 2)
print(ggplot(df, aes(x = VAF)) + geom_density(aes(group=factor(locus)), fill="grey", size=0.5, alpha=.4)+ggtitle(patient)+ylab('Density')+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour='black')))
dev.off()
pdf(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',patient,'_VAF_plot_v2.pdf'),height = 2, width = 2)
print(ggplot(df, aes(x = VAF)) + geom_density(aes(group=factor(patient)), fill="grey", size=0.5, alpha=.4)+ggtitle(patient)+ylab('Density')+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour='black')))
dev.off()
}
df
input_stat
paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/input_files/4mtr/',locus,'_input_data.txt')
write.table(input_stat,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/input_files/4mtr/',locus,'_input_data.txt'),quote=F,row.names=F,col.names=F)
View(data)
data2=data
# write.csv(data,'/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/code/small_bowel/data/Extended_Data_Table3_crypt_summary.csv',quote = F,row.names = F)
#---------median VAF---------------
for (patient in unique(data$patient)){
locus_list = data$sample[data$patient==patient]
for (locus in locus_list){
df_sample = read.table(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',locus,'_VAF.txt'),header=T)
data2$median_VAF[data$sample==locus] = median(df_sample$VAF)
}
}
View(data2)
View(data)
patient
data$sample[data$ref!="Crypt"]
patient='PD43851'
locus_list = data$sample[data$patient==patient]
main_dir=paste0('/Users/yw2/Documents/FARM/yw2/small_bowel/filter/',patient)
patient_vcf<-read.table(paste0(main_dir,"/",patient,".snp.tsv"),comment.char = "", header=T,stringsAsFactors = F)
rownames(patient_vcf)=paste(patient_vcf$Chrom,patient_vcf$Pos,patient_vcf$Ref,patient_vcf$Alt, sep = '_')
df= data.frame(matrix(nrow=0,ncol=4))
for (locus in locus_list){
if(!locus %in% data$sample[data$ref!="Crypt"]){
next
}
good_snp <-read.table(paste0("/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/code/small_bowel/data/vcf/",locus,"_final_snp.vcf"),header=F, stringsAsFactors = F)
good_snp <- good_snp[!duplicated(good_snp),]
rownames(good_snp)=paste(good_snp$V1,good_snp$V2,good_snp$V4,good_snp$V5, sep = '_')
sample_vcf = patient_vcf[rownames(good_snp),]
all_alt<-sample_vcf[,colnames(sample_vcf[grep('MTR',colnames(sample_vcf))])]
all_dep<-sample_vcf[,colnames(sample_vcf[grep('DEP',colnames(sample_vcf))])]
sample_alt<-all_alt[,colnames(all_alt)[grep(locus,colnames(all_alt))]]
sample_dep<-all_dep[,colnames(all_dep)[grep(locus,colnames(all_dep))]]
df_sample=data.frame(ALT=sample_alt,DEP=sample_dep)
df_sample <- na.omit(df_sample[df_sample$ALT>=4,])
df_sample$VAF = df_sample$ALT/df_sample$DEP
df_sample$locus = locus
write.table(df_sample,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',locus,'_VAF.txt'),quote=F,row.names=F,col.names=T)
df = rbind(df,df_sample)
input_stat=c(median(df_sample$VAF),dim(df_sample)[1])
input_stat = c(input_stat,df_sample$DEP)
n_col=100
n_row = ceiling(length(input_stat)/100)
input_stat = c(input_stat,rep("",n_col*n_row-length(input_stat)))
input_stat=matrix(input_stat,ncol = n_col,byrow=T)
write.table(input_stat,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/input_files/4mtr/',locus,'_input_data.txt'),quote=F,row.names=F,col.names=F)
}
# write.csv(data,'/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/code/small_bowel/data/Extended_Data_Table3_crypt_summary.csv',quote = F,row.names = F)
#---------median VAF---------------
for (patient in unique(data$patient)){
locus_list = data$sample[data$patient==patient]
for (locus in locus_list){
df_sample = read.table(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',locus,'_VAF.txt'),header=T)
data2$median_VAF[data$sample==locus] = median(df_sample$VAF)
}
}
View(data2)
View(data)
# write.csv(data,'/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/code/small_bowel/data/Extended_Data_Table3_crypt_summary.csv',quote = F,row.names = F)
#---------median VAF---------------
for (patient in unique(data$patient)){
locus_list = data$sample[data$patient==patient]
for (locus in locus_list){
df_sample = read.table(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/4mtr/',locus,'_VAF.txt'),header=T)
data$median_VAF[data$sample==locus] = median(df_sample$VAF)
}
}
#------------sensitivity------------
set.seed(99)
min_reads=4 #CaVEMan minimum number of reads
data$snp_sensitivity=NA
data[,2]=as.numeric(data[,2])
for (i in 1:dim(data)[1]){
data$snp_sensitivity[i]=mean(unlist(lapply(rpois(n=100000,lambda=data$coverage[i]),function(x) pbinom(q=min_reads-0.1,size=x,p=data[i,2],lower.tail = F))))
}
min_reads=5 #Pindel minimum number of reads
data$indel_sensitivity=NA
for (i in 1:dim(data)[1]){
data$indel_sensitivity[i]=mean(unlist(lapply(rpois(n=100000,lambda=data$coverage[i]),function(x) pbinom(q=min_reads-0.1,size=x,p=data[i,2],lower.tail = F))))
}
View(data)
data$sbs_count_adj<- data$sbs_count/ data$snp_sensitivity
data$indel_count_adj<- data$indel_count/data$indel_sensitivity
View(data)
data$indel_count_adj<- round(data$indel_count/data$indel_sensitivity)
data$sbs_count_adj<- round(data$sbs_count/ data$snp_sensitivity)
View(data)
setwd('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/code/small_bowel/')
library(formatR)
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=70), tidy=TRUE,warning = FALSE, message = FALSE)
knitr::opts_knit$set(root.dir = '/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/code/small_bowel/')
exposure_matrix_crypts = read.table("./data/signatures/exposure_matrix_crypts.txt",header=T,stringsAsFactors = F)
View(data)
exposure_matrix_crypts = exposure_matrix_crypts[data$sample,]
data$SBS1 <- data$sbs_count_adj*exposure_matrix_crypts$SBS1
data$SBS5 <- data$sbs_count_adj*exposure_matrix_crypts$SBS5
data$SBS2 <- data$sbs_count_adj*exposure_matrix_crypts$SBS2
data$SBS13 <- data$sbs_count_adj*exposure_matrix_crypts$SBS13
data$SBS18 <- data$sbs_count_adj*exposure_matrix_crypts$SBS18
data$SBS88 <- data$sbs_count_adj*exposure_matrix_crypts$SBS88
data$SBS35 <- data$sbs_count_adj*exposure_matrix_crypts$SBS35
data$SBS17b <- data$sbs_count_adj*exposure_matrix_crypts$SBS17b
data$SBS40 <- data$sbs_count_adj*exposure_matrix_crypts$SBS40
data$SBS41 <- data$sbs_count_adj*exposure_matrix_crypts$SBS41
View(data)
write.csv(data,'/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/code/small_bowel/data/Extended_Data_Table3_crypt_summary.csv',quote = F,row.names = F)
#---------extract VAF---------------
for (patient in unique(data$patient)){
locus_list = data$sample[data$patient==patient]
main_dir=paste0('/Users/yw2/Documents/FARM/yw2/small_bowel/filter/',patient)
patient_vcf<-read.table(paste0(main_dir,"/",patient,".snp.tsv"),comment.char = "", header=T,stringsAsFactors = F)
rownames(patient_vcf)=paste(patient_vcf$Chrom,patient_vcf$Pos,patient_vcf$Ref,patient_vcf$Alt, sep = '_')
df= data.frame(matrix(nrow=0,ncol=4))
for (locus in locus_list){
if(locus %in% data$sample[data$ref!="Crypt"]){
next
}
good_snp <-read.table(paste0("/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/code/small_bowel/data/vcf/",locus,"_final_snp.vcf"),header=F, stringsAsFactors = F)
good_snp <- good_snp[!duplicated(good_snp),]
rownames(good_snp)=paste(good_snp$V1,good_snp$V2,good_snp$V4,good_snp$V5, sep = '_')
sample_vcf = patient_vcf[rownames(good_snp),]
all_alt<-sample_vcf[,colnames(sample_vcf[grep('MTR',colnames(sample_vcf))])]
all_dep<-sample_vcf[,colnames(sample_vcf[grep('DEP',colnames(sample_vcf))])]
sample_alt<-all_alt[,colnames(all_alt)[grep(locus,colnames(all_alt))]]
sample_dep<-all_dep[,colnames(all_dep)[grep(locus,colnames(all_dep))]]
df_sample=data.frame(ALT=sample_alt,DEP=sample_dep)
df_sample <- na.omit(df_sample[df_sample$ALT>=6,])
df_sample$VAF = df_sample$ALT/df_sample$DEP
df_sample$locus = locus
write.table(df_sample,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/6mtr/',locus,'_VAF.txt'),quote=F,row.names=F,col.names=T)
df = rbind(df,df_sample)
input_stat=c(median(df_sample$VAF),dim(df_sample)[1])
input_stat = c(input_stat,df_sample$DEP)
n_col=100
n_row = ceiling(length(input_stat)/100)
input_stat = c(input_stat,rep("",n_col*n_row-length(input_stat)))
input_stat=matrix(input_stat,ncol = n_col,byrow=T)
write.table(input_stat,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/input_files/6mtr/',locus,'_input_data.txt'),quote=F,row.names=F,col.names=F)
}
df <-df[df$locus %in% data$sample[which(data$ref == 'Crypt')],]
write.table(df,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/6mtr/',patient,'_VAF.txt'),quote=F,row.names=F,col.names=T)
pdf(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/6mtr/',patient,'_VAF_plot.pdf'),height = 2, width = 2)
print(ggplot(df, aes(x = VAF)) + geom_density(aes(group=factor(locus)), fill="grey", size=0.5, alpha=.4)+ggtitle(patient)+ylab('Density')+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour='black')))
dev.off()
pdf(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/6mtr/',patient,'_VAF_plot_v2.pdf'),height = 2, width = 2)
print(ggplot(df, aes(x = VAF)) + geom_density(aes(group=factor(patient)), fill="grey", size=0.5, alpha=.4)+ggtitle(patient)+ylab('Density')+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour='black')))
dev.off()
}
#---------extract VAF---------------
for (patient in unique(data$patient)){
locus_list = data$sample[data$patient==patient]
main_dir=paste0('/Users/yw2/Documents/FARM/yw2/small_bowel/filter/',patient)
patient_vcf<-read.table(paste0(main_dir,"/",patient,".snp.tsv"),comment.char = "", header=T,stringsAsFactors = F)
rownames(patient_vcf)=paste(patient_vcf$Chrom,patient_vcf$Pos,patient_vcf$Ref,patient_vcf$Alt, sep = '_')
df= data.frame(matrix(nrow=0,ncol=4))
for (locus in locus_list){
if(locus %in% data$sample[data$ref!="Crypt"]){
next
}
good_snp <-read.table(paste0("/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/code/small_bowel/data/vcf/",locus,"_final_snp.vcf"),header=F, stringsAsFactors = F)
good_snp <- good_snp[!duplicated(good_snp),]
rownames(good_snp)=paste(good_snp$V1,good_snp$V2,good_snp$V4,good_snp$V5, sep = '_')
sample_vcf = patient_vcf[rownames(good_snp),]
all_alt<-sample_vcf[,colnames(sample_vcf[grep('MTR',colnames(sample_vcf))])]
all_dep<-sample_vcf[,colnames(sample_vcf[grep('DEP',colnames(sample_vcf))])]
sample_alt<-all_alt[,colnames(all_alt)[grep(locus,colnames(all_alt))]]
sample_dep<-all_dep[,colnames(all_dep)[grep(locus,colnames(all_dep))]]
df_sample=data.frame(ALT=sample_alt,DEP=sample_dep)
df_sample <- na.omit(df_sample[df_sample$ALT>=8,])
df_sample$VAF = df_sample$ALT/df_sample$DEP
df_sample$locus = locus
write.table(df_sample,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/8mtr/',locus,'_VAF.txt'),quote=F,row.names=F,col.names=T)
df = rbind(df,df_sample)
input_stat=c(median(df_sample$VAF),dim(df_sample)[1])
input_stat = c(input_stat,df_sample$DEP)
n_col=100
n_row = ceiling(length(input_stat)/100)
input_stat = c(input_stat,rep("",n_col*n_row-length(input_stat)))
input_stat=matrix(input_stat,ncol = n_col,byrow=T)
write.table(input_stat,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/input_files/8mtr/',locus,'_input_data.txt'),quote=F,row.names=F,col.names=F)
}
df <-df[df$locus %in% data$sample[which(data$ref == 'Crypt')],]
write.table(df,paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/8mtr/',patient,'_VAF.txt'),quote=F,row.names=F,col.names=T)
pdf(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/8mtr/',patient,'_VAF_plot.pdf'),height = 2, width = 2)
print(ggplot(df, aes(x = VAF)) + geom_density(aes(group=factor(locus)), fill="grey", size=0.5, alpha=.4)+ggtitle(patient)+ylab('Density')+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour='black')))
dev.off()
pdf(paste0('/Users/yw2/OneDrive\ -\ University\ of\ Cambridge/PhD/small_bowel/data/stem_cell/observed_VAF/8mtr/',patient,'_VAF_plot_v2.pdf'),height = 2, width = 2)
print(ggplot(df, aes(x = VAF)) + geom_density(aes(group=factor(patient)), fill="grey", size=0.5, alpha=.4)+ggtitle(patient)+ylab('Density')+theme_bw()+theme(panel.grid=element_blank(),panel.border=element_blank(),axis.line=element_line(size=1,colour='black')))
dev.off()
}
View(data)
View(data)
(54+70+77+71+74+81)
60+41+35+52+73+40
427*0.3+301*0.7
338.8/6
427/3
427/3+301*2/3
343/6
(427+301*2)/18
